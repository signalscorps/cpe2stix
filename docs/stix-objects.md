# Modelling CPEs as STIX Objects

The STIX 2.1 Specification contains a Software SCO that can be used to construct these patterns, [here is the specification for it](https://docs.oasis-open.org/cti/stix/v2.1/csprd01/stix-v2.1-csprd01.html#_Toc16070740).

The problem here is CPEs cover applications (software), operating systems (also software), and hardware (not software).

As a trade-off to ensure consistency we decided to model all CPEs as Software SCOs regardless of whether they are software or not.

### New CPE Objects

cpe2stix constructs Software SCOs for CPEs as follows;

```json
{
    "type": "software",
    "spec_version": "2.1",
    "id": "software--<GENERATED BY STIX2 LIBRARY>",
    "name": "<cpes.titles.title>",
    "cpe": "<cpes.titles.cpe23Uri>",  
    "version": "<cpes.titles.cpe23Uri[version_section]>",
    "vendor": "<cpes.titles.cpe23Uri[vendor_section]>",
    "languages": [
        "<cpes.titles.lang>"
    ],
    "revoked": "<cpes.deprecated>",
    "extensions": {
        "extension-definition--6c453e0f-9895-498f-a273-2e2dda473377": {
            "extension_type": "property-extension",
            "nvd_cpe" : {
                "PRINTED JSON CPE FIELDS"
            }
        }
    }
}
```

As an example using `cpe:2.3:a:rusqlite_project:rusqlite:0.26.0:*:*:*:*:rust:*:*`;

```json
{
      "type": "software",
      "spec_version": "2.1",
      "id": "software--bbac7ad2-a550-4d4e-af5c-78feaf455f77",
      "name": "Rusqlite Project Rusqlite 0.26.0 for Rust",
      "cpe": "cpe:2.3:a:rusqlite_project:rusqlite:0.26.0:*:*:*:*:rust:*:*",  
      "version": "0.26.0",
      "vendor": "rusqlite_project",
      "languages": "*",
      "revoked": false,
      "extensions": {
        "extension-definition--6c453e0f-9895-498f-a273-2e2dda473377": {
            "extension_type": "property-extension",
            "nvd_cpe" : {
                "deprecated": false,
                "cpe23Uri": "cpe:2.3:a:rusqlite_project:rusqlite:0.26.0:*:*:*:*:rust:*:*",
                "lastModifiedDate": "2022-01-03T14:59Z",
                "titles": [
                    {
                        "title": "Rusqlite Project Rusqlite 0.26.0 for Rust",
                        "lang": "en_US"
                    }
                ],
                "refs": [
                    {
                        "ref": "https://github.com/rusqlite/rusqlite/releases",
                        "type": "Version"
                    },
                    {
                        "ref": "https://github.com/rusqlite/rusqlite",
                        "type": "Project"
                    },
                    {
                        "ref": "https://crates.io/crates/rusqlite",
                        "type": "Project"
                    }
                ],
                "deprecatedBy": [],
                "vulnerabilities": [
                    "CVE-2021-45713",
                    "CVE-2021-45714",
                    "CVE-2021-45715",
                    "CVE-2021-45716",
                    "CVE-2021-45717",
                    "CVE-2021-45718",
                    "CVE-2021-45719"
                ]
            }
        }
    }
}
```

### Dealing with CPE updates

As noted CPEs can be periodically updated. If a CPE already exist but is returned by the NVD as updated (because `lastModifiedDate` > last run time) then cpe2stix updates the original object, but does not change the `id` property.

Occasionally some CPEs are deprecated, in which case the `deprecatedBy` will point to one or more CPEs that represent the new version of the object, e.g.

```json
    "deprecatedBy": ["cpe:2.3:a:microsoft:visio:2003:sp3:*:*:*:*:*:*"]
```

To account for these deprecations, cpe2stix first updates the original STIX CPE Object representing the deprecated CPE, and also creates a STIX SRO to the old CPE to the new CPE with the `relationship_type` `deprecatedB` ([as described in my STIX versioning tutorial](/blog/2022/oasis-stix_2_1-105-versioning)).

```json
    {
      "type": "relationship",
      "spec_version": "2.1",
      "id": "relationship--<GENERATED BY STIX2 LIBRARY>",
      "created": "<lastModifiedDate of deprecated cpe>",
      "created_by_ref": "identity--<IDENTITY ID>",
      "modified": "<lastModifiedDate of deprecated cpe>",
      "relationship_type": "deprecated-by",
      "source_ref": "software--<deprecated STIX Object>",
      "target_ref": "software--<new STIX Object>"
    }
```